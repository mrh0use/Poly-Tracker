## Replit Changes

### 1. polymarket_client.py

**Find `__init__` method (around line 183) and add this line after `_sports_tag_ids`:**

```python
self._sports_team_names: set = set()  # Team names from /teams API
```

---

**Find `fetch_sports_tags` method (around line 270) and replace the entire method with:**

```python
    async def fetch_sports_tags(self) -> set:
        """
        Fetch sports tag IDs from Polymarket's /sports endpoint.
        These tags are used to identify sports markets reliably via API data.
        """
        await self.ensure_session()
        try:
            async with self.session.get(f"{self.GAMMA_BASE_URL}/sports") as resp:
                if resp.status == 200:
                    sports_data = await resp.json()
                    tag_ids = set()
                    for sport in sports_data:
                        tags_str = sport.get('tags', '')
                        if tags_str:
                            for tag_id in tags_str.split(','):
                                tag_ids.add(tag_id.strip())
                    self._sports_tag_ids = tag_ids
                    print(f"[API] Loaded {len(tag_ids)} sports tag IDs from Polymarket API", flush=True)
                    return tag_ids
        except Exception as e:
            print(f"[API] Error fetching sports tags: {e}", flush=True)
        return set()
    
    async def fetch_sports_teams(self) -> set:
        """
        Fetch team names from Polymarket's /teams endpoint.
        Returns a set of team names (lowercase) for keyword matching.
        """
        await self.ensure_session()
        try:
            async with self.session.get(f"{self.GAMMA_BASE_URL}/teams?limit=1000") as resp:
                if resp.status == 200:
                    teams_data = await resp.json()
                    team_names = set()
                    for team in teams_data:
                        name = team.get('name', '').lower().strip()
                        alias = team.get('alias', '').lower().strip()
                        abbrev = team.get('abbreviation', '').lower().strip()
                        if name:
                            team_names.add(name)
                        if alias:
                            team_names.add(alias)
                        # Don't add abbreviations - too likely to cause false positives
                    self._sports_team_names = team_names
                    print(f"[API] Loaded {len(team_names)} sports team names from Polymarket API", flush=True)
                    return team_names
        except Exception as e:
            print(f"[API] Error fetching sports teams: {e}", flush=True)
        return set()
```

---

**Find `get_market_categories` method and replace entirely with:**

```python
    def get_market_categories(self, asset_id: str, fallback_title: str = "", fallback_slug: str = "") -> set:
        """
        Get the top-level Polymarket categories for a market.
        Returns set of category slugs like {'sports', 'politics', 'crypto'}
        
        Detection priority:
        1. API-provided sports tag IDs (from /sports endpoint) - most reliable
        2. Tag slug matching via CATEGORY_TAG_MAP
        3. API team names (from /teams endpoint)
        4. Keyword matching as fallback
        """
        market_info = self._market_cache.get(asset_id, {})
        tags = market_info.get('tags', [])
        
        # Collect all tag slugs AND tag IDs from the market
        market_tag_slugs = set()
        market_tag_ids = set()
        for tag in tags:
            if isinstance(tag, dict):
                slug = tag.get('slug', '').lower()
                tag_id = str(tag.get('id', ''))
                if slug:
                    market_tag_slugs.add(slug)
                if tag_id:
                    market_tag_ids.add(tag_id)
            elif isinstance(tag, str):
                market_tag_slugs.add(tag.lower())
        
        # Also check groupSlug
        group_slug = market_info.get('groupSlug', '').lower()
        if group_slug:
            market_tag_slugs.add(group_slug)
        
        # Map tags to top-level categories
        categories = set()
        for category, related_tags in self.CATEGORY_TAG_MAP.items():
            if market_tag_slugs & related_tags:
                categories.add(category)
        
        # CRITICAL: Check if any tag IDs match sports tags from API
        if 'sports' not in categories and self._sports_tag_ids:
            if market_tag_ids & self._sports_tag_ids:
                categories.add('sports')
        
        # Also check if groupSlug indicates sports
        if 'sports' not in categories:
            if group_slug in self.SPORTS_SLUGS:
                categories.add('sports')
        
        # Get text for keyword matching
        title = market_info.get('title', '').lower() or fallback_title.lower()
        slug = market_info.get('slug', '').lower() or fallback_slug.lower()
        text = f"{title} {slug}"
        
        # SPORTS keyword detection (if not already detected via tags)
        if 'sports' not in categories:
            for kw in self.SPORTS_KEYWORDS:
                if keyword_matches(kw, text):
                    categories.add('sports')
                    break
        
        # SPORTS team name detection from API (if not already detected)
        if 'sports' not in categories and self._sports_team_names:
            for team in self._sports_team_names:
                if len(team) > 3 and team in text:
                    categories.add('sports')
                    break
        
        # CRYPTO keyword detection (if not already detected via tags)
        if 'crypto' not in categories:
            for kw in self.CRYPTO_KEYWORDS:
                if keyword_matches(kw, text):
                    categories.add('crypto')
                    break
        
        # FINANCE keyword detection
        if 'finance' not in categories:
            finance_keywords = ['stock', 'stocks', 'treasury', 'federal reserve', 
                               'interest rate', 'bonds', 'inflation', 
                               'recession', 'trade deal', 'tariff', 'trade war', 'trade policy']
            for kw in finance_keywords:
                if keyword_matches(kw, text):
                    categories.add('finance')
                    break
        
        # ECONOMY keyword detection
        if 'economy' not in categories:
            economy_keywords = ['economy', 'economic', 'unemployment', 'jobs report', 'gdp growth']
            for kw in economy_keywords:
                if keyword_matches(kw, text):
                    categories.add('economy')
                    break
        
        # MENTIONS/TWEETS detection
        if 'mentions' not in categories:
            mentions_keywords = ['mention', 'mentions', 'tweet', 'tweets', 'x post', 'x posts',
                                'twitter mention', 'x mention']
            for kw in mentions_keywords:
                if keyword_matches(kw, text):
                    categories.add('mentions')
                    break
        
        return categories
```

---

### 2. bot.py

**Find this section (around line 448-455):**

```python
await polymarket_client.fetch_sports_tags()
print("Sports tags loaded")
```

**Replace with:**

```python
await polymarket_client.fetch_sports_tags()
await polymarket_client.fetch_sports_teams()
print("Sports tags and teams loaded from API")
```

---

## Expected startup logs

```
[API] Loaded 47 sports tag IDs from Polymarket API
[API] Loaded 892 sports team names from Polymarket API
Sports tags and teams loaded from API
```