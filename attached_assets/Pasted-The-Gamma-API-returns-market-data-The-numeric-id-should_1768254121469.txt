The Gamma API returns market data. The numeric id should be in the response. We need to:

Store market_id (numeric) in the cache
Add a function to get market ID
Use m_{market_id} format instead of the hash


Prompt for Replit:
1. In polymarket_client.py, find the refresh_market_cache function (around line 298). Update it to store the market ID. Find this block:
python                        if condition_id:
                            self._market_cache[condition_id] = {
                                'slug': market.get('slug', ''),
                                'title': market.get('question', market.get('title', '')),
                                'tags': market.get('tags', []),
                                'groupSlug': market.get('groupSlug', ''),
                                'eventSlug': event_slug,
                            }
Replace with:
python                        if condition_id:
                            self._market_cache[condition_id] = {
                                'slug': market.get('slug', ''),
                                'title': market.get('question', market.get('title', '')),
                                'tags': market.get('tags', []),
                                'groupSlug': market.get('groupSlug', ''),
                                'eventSlug': event_slug,
                                'marketId': market.get('id', ''),
                            }
Do the same for the other two places where self._market_cache[token_id] = { appears (around lines 329 and 348) - add 'marketId': market.get('id', ''), to each.
2. In polymarket_client.py, add this new function after get_event_slug_by_condition (around line 970):
python    def get_market_id(self, trade_or_activity: Dict[str, Any]) -> str:
        """Get the numeric market ID for Telegram deep links."""
        market_info = self.get_market_info(trade_or_activity)
        if market_info:
            market_id = market_info.get('marketId', '')
            if market_id:
                return str(market_id)
        return ''
3. In alerts.py, replace the entire encode_onsight_param function with:
pythondef encode_onsight_param(market_id: str) -> str:
    """Encode market ID for Onsight Telegram bot deep link."""
    if not market_id:
        return ''
    return f"m_{market_id}"
4. In alerts.py, replace the entire create_trade_button_view function with:
pythondef create_trade_button_view(market_id: str, market_url: str) -> View:
    view = View()
    encoded_param = encode_onsight_param(market_id)
    if encoded_param:
        onsight_url = f"{ONSIGHT_BOT_URL}?start={encoded_param}"
    else:
        onsight_url = ONSIGHT_BOT_URL
    view.add_item(Button(
        label="Trade via Onsight",
        url=onsight_url,
        style=discord.ButtonStyle.link,
        emoji="ðŸ“ˆ"
    ))
    return view
5. In bot.py, find all places where create_trade_button_view is called and change the first argument to use the market ID. For example, change:
pythonbutton_view = create_trade_button_view(event_slug, market_url)
To:
pythonmarket_id = polymarket_client.get_market_id(trade)
button_view = create_trade_button_view(market_id, market_url)